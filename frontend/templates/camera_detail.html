<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Camera {{ camera_id }} – {{ area_name }}</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            margin: 0;
            padding: 24px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            margin: 0 0 4px 0;
            font-size: 1.6rem;
        }
        .subtitle {
            margin: 0 0 16px 0;
            font-size: 0.9rem;
            color: #9ca3af;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 6px;
        }
        .pill-emergency { background: #b91c1c; color: #fee2e2; }
        .pill-normal { background: #166534; color: #dcfce7; }
        .pill-preventive { background: #92400e; color: #fef3c7; }
        .meta {
            font-size: 0.85rem;
            margin: 4px 0;
            color: #d1d5db;
        }
        .panel {
            margin-top: 16px;
            padding: 16px;
            border-radius: 12px;
            background: #020617;
            border: 1px solid #1f2937;
        }
        .panel-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .video-wrapper {
            margin-top: 8px;
            border-radius: 10px;
            overflow: hidden;
            background: #111827;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #93c5fd;
            text-decoration: none;
        }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
<div class="container">
    <h1>Camera {{ camera_id }} – {{ area_name }}</h1>
    <p class="subtitle">{{ description }}</p>

    <div>
        {% if status == 'emergency' %}
            <span class="pill pill-emergency">Emergency</span>
        {% elif status == 'normal' %}
            <span class="pill pill-normal">Normal Activity</span>
        {% elif status == 'preventive' %}
            <span class="pill pill-preventive">Preventive Alert</span>
        {% endif %}
        <span class="meta">Incident Type: {{ incident_type }}</span>
    </div>

    <div class="meta">Location: {{ area_name }} (GPS: {{ gps }})</div>
    {% if nearest_police_station %}
        <div class="meta">Nearest Police Station: {{ nearest_police_station }}</div>
    {% endif %}

    <div class="panel">
        <div class="panel-title">Video Feed</div>
        <div class="video-wrapper">
            {% if camera_id == '01' %}
                <video src="/camera1_video" width="100%" height="360" controls autoplay loop muted playsinline preload="metadata">
                    Your browser does not support the video tag.
                </video>
            {% elif camera_id == '02' %}
                <video src="/camera2_video" width="100%" height="360" controls autoplay loop muted playsinline preload="metadata">
                    Your browser does not support the video tag.
                </video>
            {% elif camera_id == '03' %}
                <video src="/camera3_video" width="100%" height="360" controls autoplay loop muted playsinline preload="metadata">
                    Your browser does not support the video tag.
                </video>
            {% elif camera_id == '04' %}
                <video src="/camera4_video" width="100%" height="360" controls autoplay loop muted playsinline preload="metadata">
                    Your browser does not support the video tag.
                </video>
            {% elif video_url is defined and video_url %}
                <video src="{{ video_url }}" width="100%" height="360" controls autoplay loop muted playsinline preload="metadata">
                    Your browser does not support the video tag.
                </video>
            {% else %}
                <div style="padding: 32px; text-align: center; font-size: 0.9rem; color: #9ca3af;">
                    Demo placeholder for live camera feed.
                </div>
            {% endif %}
        </div>
    </div>

    <div class="panel">
        <div class="panel-title">AI Analysis Summary</div>
        <p class="meta">{{ analysis_summary }}</p>
        <p class="meta">Recommended Action: {{ recommended_action }}</p>
    </div>

    {% if timeline is defined and timeline %}
        <div class="panel">
            <div class="panel-title">Timeline (every ~3 seconds)</div>
            <details open>
                <summary style="cursor:pointer; font-size:0.8rem; color:#9ca3af;">Show / hide timeline details</summary>
                <ul style="margin-top:8px; padding-left:18px; font-size:0.8rem; color:#d1d5db;">
                    {% for ev in timeline %}
                        <li>
                            t = {{ ev.t_sec }}s · persons = {{ ev.persons }} · vehicles = {{ ev.vehicles }}
                        </li>
                    {% endfor %}
                </ul>
            </details>
        </div>
    {% endif %}

    <div class="panel">
        <div class="panel-title">Per-Camera Monitoring Details</div>
        {% if camera_id == '01' %}
            <p class="meta">Person Count: 1 (victim)</p>
            <p class="meta">Vehicle Count: 2</p>
            <p class="meta">Motion Status: No Movement (Victim)</p>
            <p class="meta">Ambulance: {{ ambulance_status if ambulance_status is defined else 'Dispatched from dashboard logic' }}</p>
            <p class="meta">Emergency: {{ emergency if emergency is defined else 'See main dashboard status' }}</p>
            <p class="meta">Reason: {{ reason if reason is defined else 'See main dashboard status' }}</p>
        {% elif camera_id == '02' %}
            <p class="meta">Person Count: 25+</p>
            <p class="meta">Vehicle Count: Few</p>
            <p class="meta">Motion: Normal, Multi-directional</p>
            <p class="meta">Risk Level: Normal Activity Zone</p>
        {% elif camera_id == '03' %}
            <p class="meta">Person Count: 1–2</p>
            <p class="meta">Vehicle Count: 0–1</p>
            <p class="meta">Motion Pattern: Focused / Directional</p>
            <p class="meta">Risk Level: High Risk Zone (Preventive)</p>
        {% elif camera_id == '04' %}
            <p class="meta">Person Count: 1</p>
            <p class="meta">Vehicle Count: 0</p>
            <p class="meta">Motion Pattern: Slow, Isolated</p>
            <p class="meta">Risk Level: High (Preventive)</p>
            <p class="meta">Police: Deployed / Monitoring (nearest PS: {{ nearest_police_station }})</p>
        {% endif %}
    </div>

    <div class="panel">
        <div class="panel-title">Hospital Routing (Lifeline AI)</div>
        <p class="meta">Selected Hospital: {{ selected_hospital }}</p>
        <table style="width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 0.8rem;">
            <thead>
            <tr style="border-bottom: 1px solid #1f2937;">
                <th style="text-align: left; padding: 4px 6px;">#</th>
                <th style="text-align: left; padding: 4px 6px;">Hospital</th>
                <th style="text-align: left; padding: 4px 6px;">Empty ICU Beds</th>
                <th style="text-align: left; padding: 4px 6px;">Distance (km)</th>
                <th style="text-align: left; padding: 4px 6px;">Rush</th>
                <th style="text-align: left; padding: 4px 6px;">Ambulance ETA</th>
            </tr>
            </thead>
            <tbody>
            {% for h in hospitals_table %}
                <tr style="border-bottom: 1px solid #111827;">
                    <td style="padding: 4px 6px;">{{ h.priority_rank }}</td>
                    <td style="padding: 4px 6px;">{{ h.name }}</td>
                    <td style="padding: 4px 6px;">{{ h.icu_beds }}</td>
                    <td style="padding: 4px 6px;">{{ h.distance_km }}</td>
                    <td style="padding: 4px 6px;">{{ h.rush_level }}</td>
                    <td style="padding: 4px 6px;">{{ h.ambulance_eta }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <a href="/dashboard" class="back-link">← Back to City Safety Control Dashboard</a>
</div>

<!-- Footer -->
<footer style="text-align: center; padding: 24px; margin-top: 40px; border-top: 1px solid #1f2937; color: #6b7280; font-size: 0.9rem;">
    © 2026 @Virendra Jain – All Rights Reserved
</footer>

</body>
</html>
